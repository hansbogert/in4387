#!/bin/bash

# opts
mcrlOptions=''
while getopts ":m:" opt; do
  case $opt in
    m) # mcrl2lps options
      mcrl2lpsOptions="$OPTARG"
    ;;
    \?)
      echo "invalid option: -$OPTARG"
      exit 1
    ;;
    :)
      echo "-$OPTARG needs argument"
      exit 1
    ;;
  esac
  shift $((OPTIND-1))
done

# script syntax ok
if (( $# < 2 )); then
  echo usage: mcrl22bool [-m mcrl2lps-options] mcrl2-file formula
  exit 1
fi

#args
mcrlFile=$1
formula=$2
namedPipeFile=formula

# input mcrl file check
if [[ ! -f $mcrlFile ]]; then
  echo error: input mcrl file not found
  exit 1
fi

# make namedpipe if file does not exists
if [[ ! -f $namedPipeFile ]]; then
  mkfifo $namedPipeFile
else
  echo "Could not make named pipe, filename already exists"
  exit 1
fi

# execute
echo "$formula" > formula& mcrl22lps $mcrl2lpsOptions $mcrlFile | lps2pbes -f $namedPipeFile | pbes2bool

# clean up named pipe
rm $namedPipeFile
